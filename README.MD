# I. ReplicationController (RC)
ReplicationController lÃ  controller Ä‘áº§u tiÃªn trong Kubernetes dÃ¹ng Ä‘á»ƒ Ä‘áº£m báº£o sá»‘ lÆ°á»£ng Pod luÃ´n duy trÃ¬ cá»‘ Ä‘á»‹nh.

Náº¿u cÃ³ 3 replica:

- Khi 1 Pod bá»‹ crash â†’ RC táº¡o thÃªm 1 Pod má»›i.

- Náº¿u báº¡n xÃ³a thá»§ cÃ´ng 1 Pod â†’ RC sinh thÃªm 1 Pod má»›i.

# II. ReplicaSet (RS)
KhÃ¡i niá»‡m

ReplicaSet lÃ  phiÃªn báº£n nÃ¢ng cáº¥p cá»§a ReplicationController.
CÃ´ng dá»¥ng chÃ­nh: Äáº£m báº£o sá»‘ lÆ°á»£ng báº£n sao Pod (replica) luÃ´n Ä‘Ãºng vá»›i khai bÃ¡o.

NÃ³ cÅ©ng theo dÃµi cÃ¡c Pod qua selector, náº¿u thiáº¿u thÃ¬ táº¡o thÃªm, thá»«a thÃ¬ xÃ³a bá»›t.

# III. Deployment
### KhÃ¡i niá»‡m lÃ  má»™t controller trong Kubernetes, dÃ¹ng Ä‘á»ƒ quáº£n lÃ½ vÃ²ng Ä‘á»i cá»§a Pod.

Deployment lÃ  lá»›p quáº£n lÃ½ cao hÆ¡n, bao bá»c ReplicaSet, giÃºp báº¡n:

- Tá»± Ä‘á»™ng táº¡o ReplicaSet.

- Triá»ƒn khai phiÃªn báº£n má»›i (Rolling Update).

- Quay láº¡i phiÃªn báº£n cÅ© (Rollback).

- Táº¡m dá»«ng / tiáº¿p tá»¥c cáº­p nháº­t.

- Dá»… dÃ ng scale Pod.

ğŸ‘‰ NÃ³i cÃ¡ch khÃ¡c:
Deployment â†’ quáº£n lÃ½ ReplicaSet â†’ quáº£n lÃ½ Pod


| Lá»‡nh                                             | MÃ´ táº£                               |
| ------------------------------------------------ | ----------------------------------- |
| `kubectl get deploy`                             | Xem danh sÃ¡ch Deployment            |
| `kubectl get rs`                                 | Xem ReplicaSet mÃ  Deployment táº¡o ra |
| `kubectl get pods`                               | Xem cÃ¡c Pod Ä‘Æ°á»£c quáº£n lÃ½            |
| `kubectl scale deploy nginx-deploy --replicas=5` | Scale lÃªn/xuá»‘ng                     |
| `kubectl rollout status deploy nginx-deploy`     | Xem tráº¡ng thÃ¡i cáº­p nháº­t             |
| `kubectl rollout undo deploy nginx-deploy`       | Rollback vá» version trÆ°á»›c           |





# IV. K8s Service 

ğŸ§© KhÃ¡i niá»‡m:

Service trong Kubernetes chÃ­nh lÃ  cÃ¡ch â€œexposeâ€ (má»Ÿ ra) má»™t Ä‘á»‹a chá»‰ IP cá»‘ Ä‘á»‹nh Ä‘á»ƒ ngÆ°á»i khÃ¡c (hoáº·c Pod khÃ¡c) cÃ³ thá»ƒ truy cáº­p vÃ o Deployment cá»§a báº¡n.

Trong Kubernetes, Service lÃ  má»™t Ä‘á»‘i tÆ°á»£ng logic dÃ¹ng Ä‘á»ƒ Ä‘á»‹nh danh vÃ  truy cáº­p má»™t nhÃ³m Pod.
VÃ¬ Pod cÃ³ thá»ƒ thay Ä‘á»•i IP liÃªn tá»¥c (khi restart, reschedule...), nÃªn Service cung cáº¥p má»™t IP á»•n Ä‘á»‹nh (ClusterIP) vÃ  DNS name cá»‘ Ä‘á»‹nh Ä‘á»ƒ cÃ¡c Pod khÃ¡c hoáº·c ngÆ°á»i dÃ¹ng truy cáº­p.

ğŸ‘‰ NÃ³i Ä‘Æ¡n giáº£n:

- Pod = táº¡m thá»i, IP thay Ä‘á»•i.

- Service = cá»‘ Ä‘á»‹nh, lÃ  â€œcá»­aâ€ vÃ o nhÃ³m Pod.

CÃ¡ch hoáº¡t Ä‘á»™ng

1. Má»—i Service cÃ³ má»™t label selector, chá»n cÃ¡c Pod phÃ¹ há»£p.

2. Kubernetes táº¡o má»™t endpoint list chá»©a IP cá»§a cÃ¡c Pod Ä‘Ã³.

3. kube-proxy trÃªn má»—i Node táº¡o iptables rules hoáº·c IPVS rules Ä‘á»ƒ chuyá»ƒn tiáº¿p request Ä‘áº¿n má»™t trong cÃ¡c Pod (theo round-robin, randomâ€¦).


| Loáº¡i Service     | Má»¥c Ä‘Ã­ch                                          | Truy cáº­p tá»« Ä‘Ã¢u             | IP cáº¥p phÃ¡t                | ThÆ°á»ng dÃ¹ng khi                     |
| ---------------- | ------------------------------------------------- | --------------------------- | -------------------------- | ----------------------------------- |
| **ClusterIP**    | Truy cáº­p **ná»™i bá»™ cluster**                       | Pod â†’ Pod                   | Internal IP                | Microservice ná»™i bá»™                 |
| **NodePort**     | Expose ra **bÃªn ngoÃ i cluster (qua Node IP)**     | NgoÃ i cluster â†’ NodeIP:Port | Má»—i Node cÃ³ 1 port cá»‘ Ä‘á»‹nh | Dev/Test hoáº·c cáº§n truy cáº­p thá»§ cÃ´ng |
| **LoadBalancer** | DÃ¹ng **Load Balancer bÃªn ngoÃ i** (Cloud Provider) | Internet hoáº·c máº¡ng ngoÃ i    | IP Public/External         | Production, public traffic          |
| **ExternalName** | Trá» tá»›i **service bÃªn ngoÃ i cluster** (DNS name)  | Ná»™i bá»™ â†’ External resource  | KhÃ´ng táº¡o IP               | DÃ¹ng khi káº¿t ná»‘i external DB/API    |


## â€œService cÃ³ cÆ¡ cháº¿ Load Balancer khÃ´ng?â€ â€” CÃ¢u tráº£ lá»i ngáº¯n gá»n

âœ… CÃ³!

Táº¥t cáº£ cÃ¡c Service (trá»« ExternalName) trong Kubernetes Ä‘á»u thá»±c hiá»‡n load balancing á»Ÿ má»©c ná»™i bá»™ â€” tá»©c lÃ  khi báº¡n gá»­i request Ä‘áº¿n Service, nÃ³ sáº½ phÃ¢n phá»‘i traffic Ä‘á»u giá»¯a cÃ¡c Pod backend (cÃ¡c Pod matching label selector).

Tuy nhiÃªn:

CÆ¡ cháº¿ â€œload balancingâ€ nÃ y do kube-proxy Ä‘áº£m nhiá»‡m, khÃ´ng pháº£i lÃ  Load Balancer pháº§n cá»©ng hoáº·c cloud LB.


## CÃ¡ch hoáº¡t Ä‘á»™ng chi tiáº¿t
### 1ï¸âƒ£ Khi báº¡n táº¡o Service (ClusterIP, NodePort, hoáº·c LoadBalancer)

Kubernetes táº¡o má»™t Ä‘á»‘i tÆ°á»£ng Service cÃ³ IP riÃªng (ClusterIP).

kube-proxy trÃªn má»—i Node:

Theo dÃµi cÃ¡c endpoint (IP:Port cá»§a Pod).

Táº¡o iptables hoáº·c IPVS rules Ä‘á»ƒ phÃ¢n phá»‘i request Ä‘áº¿n cÃ¡c Pod.

### 2ï¸âƒ£ CÆ¡ cháº¿ cÃ¢n báº±ng táº£i ná»™i bá»™

CÃ³ 2 cháº¿ Ä‘á»™ mÃ  kube-proxy cÃ³ thá»ƒ dÃ¹ng:

1. iptables mode (máº·c Ä‘á»‹nh)

- kube-proxy cÃ i Ä‘áº·t nhiá»u rule iptables NAT Ä‘á»ƒ chá»n Pod ngáº«u nhiÃªn.

- Má»—i request Ä‘áº¿n Service IP â†’ bá»‹ NAT sang má»™t Pod IP.

- CÃ¢n báº±ng theo kiá»ƒu random hoáº·c round-robin.

- Æ¯u Ä‘iá»ƒm: nhanh, Ã­t tÃ i nguyÃªn.

2) IPVS mode

- DÃ¹ng Linux IP Virtual Server (IPVS) Ä‘á»ƒ lÃ m load balancing kernel-level.

- Hiá»‡u nÄƒng cao hÆ¡n, cÃ³ thá»ƒ chá»n thuáº­t toÃ¡n:

- rr (round robin)

- lc (least connection)

- dh (destination hashing)

- sh (source hashing)

- DÃ¹ng trong cluster lá»›n, nhiá»u Service.


| Service Type     | CÃ³ cÃ¢n báº±ng táº£i khÃ´ng? | CÆ¡ cháº¿                     | MÃ´ táº£                                                              |
| ---------------- | ---------------------- | -------------------------- | ------------------------------------------------------------------ |
| **ClusterIP**    | âœ… CÃ³                   | kube-proxy (iptables/IPVS) | CÃ¢n báº±ng request ná»™i bá»™ giá»¯a cÃ¡c Pod backend                       |
| **NodePort**     | âœ… CÃ³                   | kube-proxy (iptables/IPVS) | Khi truy cáº­p qua NodeIP:NodePort, request Ä‘Æ°á»£c chuyá»ƒn Ä‘á»u giá»¯a Pod |
| **LoadBalancer** | âœ… CÃ³ (2 táº§ng)          | kube-proxy + external LB   | Cloud LB â†’ NodePort â†’ kube-proxy â†’ Pod                             |
| **ExternalName** | âŒ KhÃ´ng                | DNS alias                  | Chá»‰ lÃ  Ã¡nh xáº¡ DNS, khÃ´ng cÃ³ balancing trong cluster                |





| TÃ­nh nÄƒng            | ClusterIP            | NodePort             | LoadBalancer        | ExternalName          |
| -------------------- | -------------------- | -------------------- | ------------------- | --------------------- |
| **Pháº¡m vi truy cáº­p** | Ná»™i bá»™ cluster       | BÃªn ngoÃ i qua NodeIP | BÃªn ngoÃ i (qua LB)  | External service      |
| **Tá»± Ä‘á»™ng scale**    | âœ…                    | âœ…                    | âœ…                   | âŒ                     |
| **IP cÃ´ng khai**     | âŒ                    | âœ… (Node IP)          | âœ… (External IP)     | âœ… (DNS)               |
| **DÃ¹ng trong cloud** | âœ…                    | âœ…                    | âœ…                   | âœ…                     |
| **PhÃ¹ há»£p cho**      | Microservices ná»™i bá»™ | Dev/test             | Production (public) | Káº¿t ná»‘i dá»‹ch vá»¥ ngoÃ i |


| ThÃ nh pháº§n       | Vai trÃ² chÃ­nh                                    |
| ---------------- | ------------------------------------------------ |
| **ClusterIP**    | Giao tiáº¿p ná»™i bá»™ trong cluster                   |
| **NodePort**     | Expose port ra ngoÃ i qua Node IP                 |
| **LoadBalancer** | Tá»± Ä‘á»™ng táº¡o LB (Cloud Provider) Ä‘á»ƒ expose public |
| **ExternalName** | Alias ná»™i bá»™ cho dá»‹ch vá»¥ ngoÃ i cluster           |
| **Ingress**      | Quáº£n lÃ½ routing HTTP(S) Ä‘áº¿n nhiá»u Service ná»™i bá»™ |


**Note: Náº¿u nhÆ° cÃ¡c pod ko thá»ƒ curl/ping Ä‘áº¿n DNS cá»§a service thÃ¬ hÃ£y nhá»› kiá»ƒm tra vxLanMode trong file deployment cá»§a Calico CNI.**


Trong Kubernetes, má»—i Service lÃ  má»™t lá»›p â€œproxyâ€ Ä‘á»ƒ truy cáº­p cÃ¡c Pod.
Äá»ƒ káº¿t ná»‘i chÃ­nh xÃ¡c, Kubernetes pháº£i biáº¿t Service láº¯ng nghe á»Ÿ port nÃ o, vÃ  Container tháº­t bÃªn trong Pod Ä‘ang cháº¡y á»Ÿ port nÃ o.

Do Ä‘Ã³, cÃ³ 3 má»©c:

- containerPort â†’ cá»•ng mÃ  á»©ng dá»¥ng bÃªn trong container Ä‘ang cháº¡y.

- targetPort â†’ cá»•ng trÃªn Pod mÃ  Service sáº½ forward request tá»›i.

- port â†’ cá»•ng mÃ  Service expose cho cÃ¡c client trong cluster.



# V. Kube-proxy lÃ  gÃ¬?

kube-proxy lÃ  má»™t thÃ nh pháº§n máº¡ng (network component) cháº¡y trÃªn má»—i node trong cluster Kubernetes.
NÃ³ cÃ³ nhiá»‡m vá»¥:

ğŸ§­ Duy trÃ¬ vÃ  Ã¡p dá»¥ng cÃ¡c quy táº¯c Ä‘á»‹nh tuyáº¿n máº¡ng (routing rules) Ä‘á»ƒ Ä‘áº£m báº£o traffic tá»« Service Ä‘Æ°á»£c chuyá»ƒn Ä‘Ãºng Ä‘áº¿n Pod.

Khi báº¡n gá»i Service, kube-proxy sáº½ biáº¿t pháº£i gá»­i request Ä‘Ã³ Ä‘áº¿n Pod nÃ o. 
``` bash

+---------------------------------------------------+
|                 Kubernetes Cluster                |
|---------------------------------------------------|
|   API Server   |   Scheduler   |   Controller     |
|---------------------------------------------------|
|   Node 1              Node 2               Node 3 |
|  +---------+          +---------+           +---------+
|  | kubelet |          | kubelet |           | kubelet |
|  | kube-proxy|        | kube-proxy|         | kube-proxy|
|  +---------+          +---------+           +---------+
|     |                     |                    |
|     v                     v                    v
|   Pod A                 Pod B                Pod C
|  (app)                 (app)                (app)
+---------------------------------------------------+
```


â†’ Má»—i node cÃ³ má»™t kube-proxy cháº¡y nhÆ° má»™t daemon (thÆ°á»ng lÃ  DaemonSet).
NÃ³ theo dÃµi Service vÃ  Endpoint tá»« API Server, sau Ä‘Ã³ thiáº¿t láº­p iptables / IPVS rules tÆ°Æ¡ng á»©ng Ä‘á»ƒ chuyá»ƒn hÆ°á»›ng traffic.

# VI. Kubelet
## Kubelet lÃ  thÃ nh pháº§n â€œagentâ€ cháº¡y trÃªn má»—i Node trong cluster Kubernetes.
NÃ³ chá»‹u trÃ¡ch nhiá»‡m Ä‘áº£m báº£o táº¥t cáº£ cÃ¡c Pod Ä‘Æ°á»£c mÃ´ táº£ bá»Ÿi Kubernetes API (hoáº·c file manifest cá»¥c bá»™) Ä‘ang cháº¡y Ä‘Ãºng cÃ¡ch trÃªn Node Ä‘Ã³.

ğŸ’¡ NÃ³i ngáº¯n gá»n: kubelet lÃ  â€œngÆ°á»i quáº£n giaâ€ cá»§a Node â€” nÃ³ nháº­n chá»‰ thá»‹ tá»« Control Plane, rá»“i Ä‘áº£m báº£o container trong Node cháº¡y Ä‘Ãºng yÃªu cáº§u.

# VII. Endpoint cá»§a Service 

Trong Kubernetes, Endpoint lÃ  má»™t Ä‘á»‘i tÆ°á»£ng (object) Ä‘áº¡i diá»‡n cho danh sÃ¡ch cÃ¡c IP:Port cá»§a Pod mÃ  má»™t Service trá» Ä‘áº¿n.

ğŸ‘‰ NÃ³i ngáº¯n gá»n:
Service = â€œÄ‘á»‹a chá»‰ áº£oâ€,
Endpoint = â€œÄ‘á»‹a chá»‰ tháº­tâ€ (PodIP + Port).

Khi báº¡n táº¡o má»™t Service vá»›i selector, Kubernetes sáº½:

- TÃ¬m táº¥t cáº£ cÃ¡c Pod cÃ³ nhÃ£n (label) khá»›p vá»›i selector Ä‘Ã³.

- Láº¥y Pod IP vÃ  cá»•ng container cá»§a chÃºng.

- Táº¡o ra má»™t Endpoint object chá»©a thÃ´ng tin Ä‘Ã³.


1. Service
``` bash
kubectl get svc web-svc

NAME       TYPE        CLUSTER-IP     PORT(S)
web-svc    ClusterIP   10.0.0.50      80/TCP
```

2. Endpoint
``` bash 
kubectl get endpoints web-svc

NAME       ENDPOINTS
web-svc    10.244.1.10:80,10.244.2.15:80,10.244.3.20:80
```

ğŸ’¡ Giáº£i thÃ­ch:

10.244.x.x lÃ  IP cá»§a tá»«ng Pod thá»±c táº¿.

Endpoint giá»¯ danh sÃ¡ch Ä‘Ã³ Ä‘á»ƒ kube-proxy hoáº·c IPVS dÃ¹ng khi Ä‘á»‹nh tuyáº¿n request.

| ThÃ nh pháº§n     | Vai trÃ²                                     | ÄÆ°á»£c táº¡o khi                               |
| -------------- | ------------------------------------------- | ------------------------------------------ |
| **Service**    | Äá»‹a chá»‰ áº£o Ä‘á»ƒ truy cáº­p Pod                  | Khi báº¡n Ä‘á»‹nh nghÄ©a `Service`               |
| **Endpoint**   | Danh sÃ¡ch IP:Port tháº­t cá»§a Pod       | Khi Pod cÃ³ label khá»›p vá»›i Service selector |
| **kube-proxy** | DÃ¹ng Endpoint Ä‘á»ƒ Ä‘á»‹nh tuyáº¿n request Ä‘áº¿n Pod | Khi Service cÃ³ traffic                     |

# VIII. CNI lÃ  gÃ¬ 
CNI lÃ  má»™t bá»™ giao thá»©c vÃ  thÆ° viá»‡n cho phÃ©p cÃ¡c há»‡ thá»‘ng nhÆ° Kubernetes, Mesos hay Cloud Foundry káº¿t ná»‘i máº¡ng cho container.
CNI Ä‘á»‹nh nghÄ©a cÃ¡ch má»™t plugin máº¡ng nÃªn táº¡o, cáº¥u hÃ¬nh vÃ  xÃ³a interface máº¡ng trong container.

NÃ³i Ä‘Æ¡n giáº£n: Kubernetes khÃ´ng tá»± quáº£n lÃ½ máº¡ng â€” nÃ³ dá»±a vÃ o CNI plugin Ä‘á»ƒ lÃ m viá»‡c nÃ y.

### Vai trÃ² cá»§a CNI trong Kubernetes

Trong Kubernetes, khi má»™t Pod Ä‘Æ°á»£c táº¡o, kubelet sáº½:

1. Gá»i CNI plugin Ä‘á»ƒ cáº¥p IP cho Pod.

2. Cáº¥u hÃ¬nh interface máº¡ng (eth0) trong container.

3. Äáº£m báº£o Pod cÃ³ thá»ƒ liÃªn láº¡c vá»›i cÃ¡c Pod khÃ¡c trong cluster.

Khi Pod bá»‹ xÃ³a, kubelet láº¡i gá»i CNI Ä‘á»ƒ thu há»“i IP vÃ  xÃ³a cáº¥u hÃ¬nh máº¡ng tÆ°Æ¡ng á»©ng.

| TÃªn Plugin    | Äáº·c Ä‘iá»ƒm chÃ­nh                                                         |
| ------------- | ---------------------------------------------------------------------- |
| **Flannel**   | Dá»… cÃ i Ä‘áº·t, phÃ¹ há»£p cho mÃ´i trÆ°á»ng nhá»; dÃ¹ng VXLAN Ä‘á»ƒ overlay network. |
| **Calico**    | Hiá»‡u nÄƒng cao, há»— trá»£ network policy vÃ  routing á»Ÿ layer 3.             |
| **Weave Net** | Dá»… thiáº¿t láº­p, tá»± Ä‘á»™ng mesh network giá»¯a cÃ¡c node.                      |
| **Cilium**    | Sá»­ dá»¥ng eBPF, máº¡nh vá» báº£o máº­t vÃ  quan sÃ¡t lÆ°u lÆ°á»£ng.                   |
| **Canal**     | Káº¿t há»£p Calico (network policy) + Flannel (overlay).                   |


Kubelet<br>
  â””â”€â”€ gá»i CNI plugin (vÃ­ dá»¥: Calico)<br>
        â”œâ”€â”€ Táº¡o interface eth0 trong container<br>
        â”œâ”€â”€ GÃ¡n Ä‘á»‹a chá»‰ IP<br>
        â”œâ”€â”€ Thiáº¿t láº­p routing table<br>
        â””â”€â”€ Cáº­p nháº­t cáº¥u hÃ¬nh máº¡ng cho Pod
 

# IX. PVC vÃ  PV trong K8S
## ğŸ’¾ 1. PV (Persistent Volume) â€” â€œá»” cá»©ng tháº­tâ€

ğŸ‘‰ HÃ£y tÆ°á»Ÿng tÆ°á»£ng PV giá»‘ng nhÆ° má»™t á»• cá»©ng hoáº·c USB tháº­t mÃ  quáº£n trá»‹ viÃªn (admin) chuáº©n bá»‹ sáºµn cho báº¡n.
NÃ³ lÃ  nÆ¡i Ä‘á»ƒ lÆ°u dá»¯ liá»‡u lÃ¢u dÃ i, khÃ´ng máº¥t Ä‘i khi Pod bá»‹ xÃ³a hoáº·c khá»Ÿi Ä‘á»™ng láº¡i.

VÃ­ dá»¥:

PV cÃ³ thá»ƒ lÃ  á»• Ä‘Ä©a trÃªn mÃ¡y chá»§, á»• EBS cá»§a AWS, hoáº·c thÆ° má»¥c /mnt/data trÃªn Node.

## ğŸ“œ 2. PVC (Persistent Volume Claim) â€” â€œYÃªu cáº§u mÆ°á»£n á»• cá»©ngâ€

PVC giá»‘ng nhÆ° phiáº¿u mÆ°á»£n á»• cá»©ng ğŸ§¾.
Khi báº¡n (developer) muá»‘n lÆ°u dá»¯ liá»‡u, báº¡n khÃ´ng cháº¡m vÃ o á»• cá»©ng trá»±c tiáº¿p â€” báº¡n chá»‰ gá»­i yÃªu cáº§u (PVC) cho Kubernetes:

â€œTÃ´i cáº§n 2GB Ä‘á»ƒ lÆ°u dá»¯ liá»‡u.â€

Kubernetes sáº½ tÃ¬m má»™t PV phÃ¹ há»£p (cÃ³ Ä‘á»§ dung lÆ°á»£ng vÃ  cÃ²n trá»‘ng) Ä‘á»ƒ â€œcho báº¡n mÆ°á»£nâ€.


## ğŸ”„ 3. CÃ¡ch hoáº¡t Ä‘á»™ng dá»… hiá»ƒu

          NgÆ°á»i dÃ¹ng (Pod)
                    â†“
          Táº¡o PVC (yÃªu cáº§u 2GB)
                    â†“
    Kubernetes tÃ¬m PV (á»• 5GB cÃ³ sáºµn)
                    â†“
            PVC gáº¯n vá»›i PV
                    â†“
    Pod lÆ°u dá»¯ liá»‡u lÃªn PV qua PVC

# X. K8S Network
## ğŸŒ 1. Má»¥c tiÃªu cá»§a máº¡ng trong Kubernetes

Kubernetes cÃ³ má»™t nguyÃªn táº¯c cÆ¡ báº£n:

"Má»—i Pod cÃ³ Ä‘á»‹a chá»‰ IP riÃªng, vÃ  táº¥t cáº£ Pod cÃ³ thá»ƒ giao tiáº¿p trá»±c tiáº¿p vá»›i nhau mÃ  khÃ´ng cáº§n NAT."

Äiá»u nÃ y nghÄ©a lÃ :

- Má»—i Pod lÃ  má»™t â€œmÃ¡y áº£o nhá»â€ cÃ³ IP riÃªng.

- CÃ¡c Pod trÃªn cÃ¹ng hoáº·c khÃ¡c Node Ä‘á»u cÃ³ thá»ƒ nÃ³i chuyá»‡n trá»±c tiáº¿p.

- NgÆ°á»i dÃ¹ng hoáº·c cÃ¡c Pod khÃ¡c cÃ³ thá»ƒ truy cáº­p Pod thÃ´ng qua Service.

## ğŸ§© 2. CÃ¡c loáº¡i máº¡ng trong Kubernetes

K8s cÃ³ 4 táº§ng máº¡ng chÃ­nh, má»—i táº§ng cÃ³ vai trÃ² riÃªng:
| Táº§ng máº¡ng                     | MÃ´ táº£ ngáº¯n                                                    |
| ----------------------------- | ------------------------------------------------------------- |
| **1. Container-to-Container** | CÃ¡c container trong cÃ¹ng má»™t Pod nÃ³i chuyá»‡n qua `localhost`.  |
| **2. Pod-to-Pod**             | CÃ¡c Pod (cÃ¹ng hoáº·c khÃ¡c Node) nÃ³i chuyá»‡n vá»›i nhau qua IP.     |
| **3. Pod-to-Service**         | Pod truy cáº­p Service (qua DNS, ClusterIP, hoáº·c LoadBalancer). |
| **4. External-to-Service**    | NgÆ°á»i dÃ¹ng bÃªn ngoÃ i cluster truy cáº­p á»©ng dá»¥ng trong cluster. |

## ğŸ§± 3. CÃ¡c thÃ nh pháº§n chÃ­nh cá»§a máº¡ng K8s
### ğŸ”¹CNI Plugin (Container Network Interface)

CNI (nhÆ° Calico, Flannel, Cilium) chá»‹u trÃ¡ch nhiá»‡m cáº¥p IP cho Pod, thiáº¿t láº­p route, vÃ  Ä‘áº£m báº£o Pod cÃ³ thá»ƒ liÃªn láº¡c vá»›i nhau.

ğŸ‘‰ ÄÃ¢y lÃ  táº§ng "cÆ¡ sá»Ÿ háº¡ táº§ng" cá»§a máº¡ng trong Kubernetes.

### ğŸ”¹Kube-proxy

- Kube-proxy cháº¡y trÃªn má»—i Node vÃ  xá»­ lÃ½ traffic cá»§a Service.

- Duy trÃ¬ iptables hoáº·c IPVS rules Ä‘á»ƒ Ä‘á»‹nh tuyáº¿n traffic Ä‘áº¿n Pod phÃ¹ há»£p.

- GiÃºp Service cÃ³ thá»ƒ phÃ¢n táº£i (load balancing) giá»¯a nhiá»u Pod.

### ğŸ”¹CoreDNS

- CoreDNS lÃ  DNS server ná»™i bá»™ trong Kubernetes.

Khi báº¡n gá»i http://nginx.default.svc.cluster.local, DNS sáº½ phÃ¢n giáº£i tÃªn thÃ nh ClusterIP cá»§a Service.

## ğŸ”„ 4. CÃ¡ch Pod giao tiáº¿p trong máº¡ng
### ğŸ”¸ Pod cÃ¹ng Node

CÃ¡c Pod trÃªn cÃ¹ng Node nÃ³i chuyá»‡n qua bridge network (cni0 hoáº·c flannel.1).

KhÃ´ng cáº§n NAT, chá»‰ route ná»™i bá»™.

### ğŸ”¸ Pod khÃ¡c Node

CNI plugin thiáº¿t láº­p overlay network (VXLAN, BGP, eBPFâ€¦).

Traffic Ä‘Æ°á»£c Ä‘Ã³ng gÃ³i vÃ  gá»­i qua Node khÃ¡c.

### ğŸ”¸ Pod truy cáº­p Service

Pod gá»­i request Ä‘áº¿n ClusterIP (áº£o).

kube-proxy Ä‘iá»u hÆ°á»›ng traffic Ä‘áº¿n má»™t trong cÃ¡c Pod backend.

### ğŸ”¸ BÃªn ngoÃ i truy cáº­p cluster

Qua NodePort, LoadBalancer, hoáº·c Ingress Controller (vÃ­ dá»¥: Nginx Ingress, Traefik).

## ğŸŒ‰ 5. CÃ¡c loáº¡i Service trong Kubernetes
| Loáº¡i             | Má»¥c Ä‘Ã­ch                                      | CÃ¡ch truy cáº­p     |
| ---------------- | --------------------------------------------- | ----------------- |
| **ClusterIP**    | Máº·c Ä‘á»‹nh, chá»‰ truy cáº­p trong cluster          | IP ná»™i bá»™ (áº£o)    |
| **NodePort**     | Cho phÃ©p truy cáº­p tá»« bÃªn ngoÃ i qua port Node  | `NodeIP:NodePort` |
| **LoadBalancer** | DÃ¹ng cho cloud (AWS, GCP...) Ä‘á»ƒ cáº¥p IP public | IP cÃ´ng khai      |
| **ExternalName** | Chuyá»ƒn hÆ°á»›ng DNS Ä‘áº¿n service bÃªn ngoÃ i        | DNS record        |

## ğŸ“Š 6. TÃ³m táº¯t
| ThÃ nh pháº§n     | Vai trÃ²                                  |
| -------------- | ---------------------------------------- |
| **CNI Plugin** | Cáº¥p IP, thiáº¿t láº­p máº¡ng giá»¯a Pod          |
| **kube-proxy** | Äá»‹nh tuyáº¿n vÃ  cÃ¢n báº±ng táº£i Service       |
| **CoreDNS**    | PhÃ¢n giáº£i tÃªn miá»n ná»™i bá»™                |
| **Service**    | Táº¡o Ä‘iá»ƒm truy cáº­p á»•n Ä‘á»‹nh cho Pod        |
| **Ingress**    | Quáº£n lÃ½ truy cáº­p HTTP/HTTPS tá»« bÃªn ngoÃ i |

# XI. CoreDNS
## ğŸ§­ 1. CoreDNS 
- LÃ  DNS Server (mÃ¡y chá»§ phÃ¢n giáº£i tÃªn miá»n) máº·c Ä‘á»‹nh trong Kubernetes.
- NÃ³ giÃºp cÃ¡c Pod vÃ  Service trong cluster tÃ¬m tháº¥y nhau báº±ng tÃªn, thay vÃ¬ pháº£i nhá»› Ä‘á»‹a chá»‰ IP.

## ğŸŒ 2. VÃ­ dá»¥ dá»… hiá»ƒu
Giáº£ sá»­ báº¡n cÃ³ 2 Service:

- frontend trong namespace default

- backend trong namespace default

Pod trong frontend muá»‘n gá»i backend, chá»‰ cáº§n gá»i:

```bash
curl http://backend.default.svc.cluster.local
```

CoreDNS sáº½ phÃ¢n giáº£i tÃªn nÃ y thÃ nh IP cá»§a Service backend, vÃ­ dá»¥:
```bash
10.96.0.15
```

## âš™ï¸ 3. Cáº¥u trÃºc phÃ¢n giáº£i DNS trong Kubernetes
TÃªn Ä‘áº§y Ä‘á»§ cá»§a má»™t Service cÃ³ dáº¡ng:
```bash
<ServiceName>.<Namespace>.svc.cluster.local
```

VÃ­ dá»¥:

```bash
nginx.default.svc.cluster.local
```

- nginx: TÃªn Service

- default: Namespace

- svc: Loáº¡i Ä‘á»‘i tÆ°á»£ng (Service)

- cluster.local: Domain máº·c Ä‘á»‹nh cá»§a cluster

## ğŸ§© 4. CÃ¡ch CoreDNS hoáº¡t Ä‘á»™ng

- Má»—i Pod trong cluster sáº½ tá»± Ä‘á»™ng cáº¥u hÃ¬nh DNS Ä‘á»ƒ trá» Ä‘áº¿n CoreDNS (qua file /etc/resolv.conf).

- Khi Pod gá»­i yÃªu cáº§u DNS, nÃ³ Ä‘i Ä‘áº¿n Pod CoreDNS (thÆ°á»ng náº±m trong namespace kube-system).

- CoreDNS Ä‘á»c thÃ´ng tin Service/Pod tá»« Kubernetes API Server.

- CoreDNS tráº£ láº¡i Ä‘á»‹a chá»‰ IP tÆ°Æ¡ng á»©ng cho Pod hoáº·c Service.

## 5. TÃ³m táº¯t
| ThÃ nh pháº§n          | Vai trÃ²                            |
| ------------------- | ---------------------------------- |
| **CoreDNS**         | DNS server ná»™i bá»™ trong Kubernetes |
| **Nhiá»‡m vá»¥**        | PhÃ¢n giáº£i tÃªn Service/Pod thÃ nh IP |
| **Vá»‹ trÃ­**          | Namespace `kube-system`            |
| **Thay tháº¿**        | TrÆ°á»›c Ä‘Ã¢y lÃ  kube-dns              |
| **Domain máº·c Ä‘á»‹nh** | `.cluster.local`                   |


<div align="center">

[Pod A] â†’ "backend.default.svc.cluster.local" <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;â†“<br>
[CoreDNS]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;â†“<br>
Kubernetes API â†’ tÃ¬m Service "backend"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;â†“<br>
Tráº£ vá» IP: 10.96.0.15

</div>


ğŸ‘‰ TÃ³m gá»n 1 cÃ¢u:

CoreDNS trong Kubernetes lÃ  bá»™ nÃ£o DNS giÃºp cÃ¡c Pod vÃ  Service tÃ¬m tháº¥y nhau qua tÃªn, thay vÃ¬ IP.


# XII. ConfigMap

## ğŸ§  1. ConfigMap lÃ  gÃ¬?

ConfigMap lÃ  má»™t Ä‘á»‘i tÆ°á»£ng (object) trong Kubernetes dÃ¹ng Ä‘á»ƒ lÆ°u trá»¯ dá»¯ liá»‡u cáº¥u hÃ¬nh (configuration data) cho á»©ng dá»¥ng.
NÃ³ giÃºp báº¡n tÃ¡ch riÃªng pháº§n cáº¥u hÃ¬nh ra khá»i code cá»§a container.

ğŸ’¡ NÃ³i ngáº¯n gá»n:
ConfigMap = file cáº¥u hÃ¬nh cá»§a á»©ng dá»¥ng trong Kubernetes.

## ğŸ” 2. Táº¡i sao cáº§n ConfigMap?

Trong thá»±c táº¿, á»©ng dá»¥ng thÆ°á»ng cÃ³ cÃ¡c thÃ´ng sá»‘ nhÆ°:

- Äá»‹a chá»‰ cÆ¡ sá»Ÿ dá»¯ liá»‡u (DB_HOST)

- Cá»•ng (PORT)

- Cháº¿ Ä‘á»™ cháº¡y (ENV=production)

Náº¿u báº¡n viáº¿t cÃ¡c giÃ¡ trá»‹ nÃ y cá»©ng trong code hoáº·c image, khi muá»‘n thay Ä‘á»•i, báº¡n pháº£i build láº¡i image â€” ráº¥t tá»‘n cÃ´ng.

ğŸ‘‰ ConfigMap giÃºp giáº£i quyáº¿t váº¥n Ä‘á» Ä‘Ã³:
Báº¡n chá»‰ cáº§n chá»‰nh ConfigMap, Pod tá»± Ä‘á»™ng Ä‘á»c cáº¥u hÃ¬nh má»›i mÃ  khÃ´ng cáº§n rebuild container.

## ğŸ”„ 3. Khi nÃ o dÃ¹ng ConfigMap

| TÃ¬nh huá»‘ng                                   | Giáº£i phÃ¡p     |
| -------------------------------------------- | ------------- |
| Cáº§n cáº¥u hÃ¬nh khÃ´ng báº£o máº­t (public)          | **ConfigMap** |
| Cáº§n lÆ°u thÃ´ng tin nháº¡y cáº£m (password, token) | **Secret**    |
| Cáº§n mount file cáº¥u hÃ¬nh (JSON, YAML)         | **ConfigMap** |
| Cáº§n truyá»n nhiá»u biáº¿n mÃ´i trÆ°á»ng vÃ o Pod     | **ConfigMap** |

## ğŸš€ 4. TÃ³m táº¯t

| ThÃ nh pháº§n          | Vai trÃ²                                               |
| ------------------- | ----------------------------------------------------- |
| **ConfigMap**       | LÆ°u dá»¯ liá»‡u cáº¥u hÃ¬nh dáº¡ng keyâ€“value                   |
| **Táº¡o bá»Ÿi**         | YAML file hoáº·c lá»‡nh `kubectl`                         |
| **DÃ¹ng trong**      | Pod, Deployment, hoáº·c Job                             |
| **KhÃ¡c vá»›i Secret** | Secret dÃ¹ng cho dá»¯ liá»‡u nháº¡y cáº£m (Ä‘Æ°á»£c mÃ£ hÃ³a Base64) |


<div align="left">

ConfigMap<br>
&nbsp;&nbsp;â”œâ”€â”€ APP_ENV: production<br>
&nbsp;&nbsp;â””â”€â”€ DB_HOST: postgres-service<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;â”‚<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;â–¼<br>
Pod<br>
&nbsp;&nbsp;â””â”€â”€ container<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;â””â”€â”€ image

</div>


