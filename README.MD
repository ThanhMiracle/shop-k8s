# I. ReplicationController (RC)
ReplicationController lÃ  controller Ä‘áº§u tiÃªn trong Kubernetes dÃ¹ng Ä‘á»ƒ Ä‘áº£m báº£o sá»‘ lÆ°á»£ng Pod luÃ´n duy trÃ¬ cá»‘ Ä‘á»‹nh.

Náº¿u cÃ³ 3 replica:

- Khi 1 Pod bá»‹ crash â†’ RC táº¡o thÃªm 1 Pod má»›i.

- Náº¿u báº¡n xÃ³a thá»§ cÃ´ng 1 Pod â†’ RC sinh thÃªm 1 Pod má»›i.

# II. ReplicaSet (RS)
KhÃ¡i niá»‡m

ReplicaSet lÃ  phiÃªn báº£n nÃ¢ng cáº¥p cá»§a ReplicationController.
CÃ´ng dá»¥ng chÃ­nh: Äáº£m báº£o sá»‘ lÆ°á»£ng báº£n sao Pod (replica) luÃ´n Ä‘Ãºng vá»›i khai bÃ¡o.

NÃ³ cÅ©ng theo dÃµi cÃ¡c Pod qua selector, náº¿u thiáº¿u thÃ¬ táº¡o thÃªm, thá»«a thÃ¬ xÃ³a bá»›t.

# III. Deployment
KhÃ¡i niá»‡m

Deployment lÃ  lá»›p quáº£n lÃ½ cao hÆ¡n, bao bá»c ReplicaSet, giÃºp báº¡n:

- Tá»± Ä‘á»™ng táº¡o ReplicaSet.

- Triá»ƒn khai phiÃªn báº£n má»›i (Rolling Update).

- Quay láº¡i phiÃªn báº£n cÅ© (Rollback).

- Táº¡m dá»«ng / tiáº¿p tá»¥c cáº­p nháº­t.

- Dá»… dÃ ng scale Pod.

ğŸ‘‰ NÃ³i cÃ¡ch khÃ¡c:
Deployment â†’ quáº£n lÃ½ ReplicaSet â†’ quáº£n lÃ½ Pod


| Lá»‡nh                                             | MÃ´ táº£                               |
| ------------------------------------------------ | ----------------------------------- |
| `kubectl get deploy`                             | Xem danh sÃ¡ch Deployment            |
| `kubectl get rs`                                 | Xem ReplicaSet mÃ  Deployment táº¡o ra |
| `kubectl get pods`                               | Xem cÃ¡c Pod Ä‘Æ°á»£c quáº£n lÃ½            |
| `kubectl scale deploy nginx-deploy --replicas=5` | Scale lÃªn/xuá»‘ng                     |
| `kubectl rollout status deploy nginx-deploy`     | Xem tráº¡ng thÃ¡i cáº­p nháº­t             |
| `kubectl rollout undo deploy nginx-deploy`       | Rollback vá» version trÆ°á»›c           |





# IV. K8s Service 

ğŸ§© KhÃ¡i niá»‡m:

Trong Kubernetes, Service lÃ  má»™t Ä‘á»‘i tÆ°á»£ng logic dÃ¹ng Ä‘á»ƒ Ä‘á»‹nh danh vÃ  truy cáº­p má»™t nhÃ³m Pod.
VÃ¬ Pod cÃ³ thá»ƒ thay Ä‘á»•i IP liÃªn tá»¥c (khi restart, reschedule...), nÃªn Service cung cáº¥p má»™t IP á»•n Ä‘á»‹nh (ClusterIP) vÃ  DNS name cá»‘ Ä‘á»‹nh Ä‘á»ƒ cÃ¡c Pod khÃ¡c hoáº·c ngÆ°á»i dÃ¹ng truy cáº­p.

ğŸ‘‰ NÃ³i Ä‘Æ¡n giáº£n:

- Pod = táº¡m thá»i, IP thay Ä‘á»•i.

- Service = cá»‘ Ä‘á»‹nh, lÃ  â€œcá»­aâ€ vÃ o nhÃ³m Pod.

CÃ¡ch hoáº¡t Ä‘á»™ng

1. Má»—i Service cÃ³ má»™t label selector, chá»n cÃ¡c Pod phÃ¹ há»£p.

2. Kubernetes táº¡o má»™t endpoint list chá»©a IP cá»§a cÃ¡c Pod Ä‘Ã³.

3. kube-proxy trÃªn má»—i Node táº¡o iptables rules hoáº·c IPVS rules Ä‘á»ƒ chuyá»ƒn tiáº¿p request Ä‘áº¿n má»™t trong cÃ¡c Pod (theo round-robin, randomâ€¦).


| Loáº¡i Service     | Má»¥c Ä‘Ã­ch                                          | Truy cáº­p tá»« Ä‘Ã¢u             | IP cáº¥p phÃ¡t                | ThÆ°á»ng dÃ¹ng khi                     |
| ---------------- | ------------------------------------------------- | --------------------------- | -------------------------- | ----------------------------------- |
| **ClusterIP**    | Truy cáº­p **ná»™i bá»™ cluster**                       | Pod â†’ Pod                   | Internal IP                | Microservice ná»™i bá»™                 |
| **NodePort**     | Expose ra **bÃªn ngoÃ i cluster (qua Node IP)**     | NgoÃ i cluster â†’ NodeIP:Port | Má»—i Node cÃ³ 1 port cá»‘ Ä‘á»‹nh | Dev/Test hoáº·c cáº§n truy cáº­p thá»§ cÃ´ng |
| **LoadBalancer** | DÃ¹ng **Load Balancer bÃªn ngoÃ i** (Cloud Provider) | Internet hoáº·c máº¡ng ngoÃ i    | IP Public/External         | Production, public traffic          |
| **ExternalName** | Trá» tá»›i **service bÃªn ngoÃ i cluster** (DNS name)  | Ná»™i bá»™ â†’ External resource  | KhÃ´ng táº¡o IP               | DÃ¹ng khi káº¿t ná»‘i external DB/API    |


# â€œService cÃ³ cÆ¡ cháº¿ Load Balancer khÃ´ng?â€ â€” CÃ¢u tráº£ lá»i ngáº¯n gá»n

âœ… CÃ³!

Táº¥t cáº£ cÃ¡c Service (trá»« ExternalName) trong Kubernetes Ä‘á»u thá»±c hiá»‡n load balancing á»Ÿ má»©c ná»™i bá»™ â€” tá»©c lÃ  khi báº¡n gá»­i request Ä‘áº¿n Service, nÃ³ sáº½ phÃ¢n phá»‘i traffic Ä‘á»u giá»¯a cÃ¡c Pod backend (cÃ¡c Pod matching label selector).

Tuy nhiÃªn:

CÆ¡ cháº¿ â€œload balancingâ€ nÃ y do kube-proxy Ä‘áº£m nhiá»‡m, khÃ´ng pháº£i lÃ  Load Balancer pháº§n cá»©ng hoáº·c cloud LB.


## CÃ¡ch hoáº¡t Ä‘á»™ng chi tiáº¿t
### 1ï¸âƒ£ Khi báº¡n táº¡o Service (ClusterIP, NodePort, hoáº·c LoadBalancer)

Kubernetes táº¡o má»™t Ä‘á»‘i tÆ°á»£ng Service cÃ³ IP riÃªng (ClusterIP).

kube-proxy trÃªn má»—i Node:

Theo dÃµi cÃ¡c endpoint (IP:Port cá»§a Pod).

Táº¡o iptables hoáº·c IPVS rules Ä‘á»ƒ phÃ¢n phá»‘i request Ä‘áº¿n cÃ¡c Pod.

### 2ï¸âƒ£ CÆ¡ cháº¿ cÃ¢n báº±ng táº£i ná»™i bá»™

CÃ³ 2 cháº¿ Ä‘á»™ mÃ  kube-proxy cÃ³ thá»ƒ dÃ¹ng:

1. iptables mode (máº·c Ä‘á»‹nh)

- kube-proxy cÃ i Ä‘áº·t nhiá»u rule iptables NAT Ä‘á»ƒ chá»n Pod ngáº«u nhiÃªn.

- Má»—i request Ä‘áº¿n Service IP â†’ bá»‹ NAT sang má»™t Pod IP.

- CÃ¢n báº±ng theo kiá»ƒu random hoáº·c round-robin.

- Æ¯u Ä‘iá»ƒm: nhanh, Ã­t tÃ i nguyÃªn.

2) IPVS mode

- DÃ¹ng Linux IP Virtual Server (IPVS) Ä‘á»ƒ lÃ m load balancing kernel-level.

- Hiá»‡u nÄƒng cao hÆ¡n, cÃ³ thá»ƒ chá»n thuáº­t toÃ¡n:

- rr (round robin)

- lc (least connection)

- dh (destination hashing)

- sh (source hashing)

- DÃ¹ng trong cluster lá»›n, nhiá»u Service.


| Service Type     | CÃ³ cÃ¢n báº±ng táº£i khÃ´ng? | CÆ¡ cháº¿                     | MÃ´ táº£                                                              |
| ---------------- | ---------------------- | -------------------------- | ------------------------------------------------------------------ |
| **ClusterIP**    | âœ… CÃ³                   | kube-proxy (iptables/IPVS) | CÃ¢n báº±ng request ná»™i bá»™ giá»¯a cÃ¡c Pod backend                       |
| **NodePort**     | âœ… CÃ³                   | kube-proxy (iptables/IPVS) | Khi truy cáº­p qua NodeIP:NodePort, request Ä‘Æ°á»£c chuyá»ƒn Ä‘á»u giá»¯a Pod |
| **LoadBalancer** | âœ… CÃ³ (2 táº§ng)          | kube-proxy + external LB   | Cloud LB â†’ NodePort â†’ kube-proxy â†’ Pod                             |
| **ExternalName** | âŒ KhÃ´ng                | DNS alias                  | Chá»‰ lÃ  Ã¡nh xáº¡ DNS, khÃ´ng cÃ³ balancing trong cluster                |





| TÃ­nh nÄƒng            | ClusterIP            | NodePort             | LoadBalancer        | ExternalName          |
| -------------------- | -------------------- | -------------------- | ------------------- | --------------------- |
| **Pháº¡m vi truy cáº­p** | Ná»™i bá»™ cluster       | BÃªn ngoÃ i qua NodeIP | BÃªn ngoÃ i (qua LB)  | External service      |
| **Tá»± Ä‘á»™ng scale**    | âœ…                    | âœ…                    | âœ…                   | âŒ                     |
| **IP cÃ´ng khai**     | âŒ                    | âœ… (Node IP)          | âœ… (External IP)     | âœ… (DNS)               |
| **DÃ¹ng trong cloud** | âœ…                    | âœ…                    | âœ…                   | âœ…                     |
| **PhÃ¹ há»£p cho**      | Microservices ná»™i bá»™ | Dev/test             | Production (public) | Káº¿t ná»‘i dá»‹ch vá»¥ ngoÃ i |


| ThÃ nh pháº§n       | Vai trÃ² chÃ­nh                                    |
| ---------------- | ------------------------------------------------ |
| **ClusterIP**    | Giao tiáº¿p ná»™i bá»™ trong cluster                   |
| **NodePort**     | Expose port ra ngoÃ i qua Node IP                 |
| **LoadBalancer** | Tá»± Ä‘á»™ng táº¡o LB (Cloud Provider) Ä‘á»ƒ expose public |
| **ExternalName** | Alias ná»™i bá»™ cho dá»‹ch vá»¥ ngoÃ i cluster           |
| **Ingress**      | Quáº£n lÃ½ routing HTTP(S) Ä‘áº¿n nhiá»u Service ná»™i bá»™ |


### Note: Náº¿u nhÆ° cÃ¡c pod ko thá»ƒ curl/ping Ä‘áº¿n DNS cá»§a service thÃ¬ hÃ£y nhá»› kiá»ƒm tra vxLanMode cá»§a Calico DNS.


Trong Kubernetes, má»—i Service lÃ  má»™t lá»›p â€œproxyâ€ Ä‘á»ƒ truy cáº­p cÃ¡c Pod.
Äá»ƒ káº¿t ná»‘i chÃ­nh xÃ¡c, Kubernetes pháº£i biáº¿t Service láº¯ng nghe á»Ÿ port nÃ o, vÃ  Container tháº­t bÃªn trong Pod Ä‘ang cháº¡y á»Ÿ port nÃ o.

Do Ä‘Ã³, cÃ³ 3 má»©c:

- containerPort â†’ cá»•ng mÃ  á»©ng dá»¥ng bÃªn trong container Ä‘ang cháº¡y.

- targetPort â†’ cá»•ng trÃªn Pod mÃ  Service sáº½ forward request tá»›i.

- port â†’ cá»•ng mÃ  Service expose cho cÃ¡c client trong cluster.


